<!DOCTYPE html>
<html>
<head>
  <title>backbone-min.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../", thisFile = "courses/courses/cscc09f15/pateljun/assignments/a1/Aurora//js/lib/backbone-min.js", defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#sourcemappingurl%3Dbackbone-min.map">sourceMappingURL=backbone-min.map</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>backbone-min.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="k">typeof</span> <span class="nx">self</span><span class="o">==</span><span class="s2">&quot;object&quot;</span><span class="o">&amp;&amp;</span><span class="nx">self</span><span class="p">.</span><span class="nx">self</span><span class="o">==</span><span class="nx">self</span><span class="o">&amp;&amp;</span><span class="nx">self</span><span class="o">||</span><span class="k">typeof</span> <span class="nx">global</span><span class="o">==</span><span class="s2">&quot;object&quot;</span><span class="o">&amp;&amp;</span><span class="nx">global</span><span class="p">.</span><span class="nx">global</span><span class="o">==</span><span class="nx">global</span><span class="o">&amp;&amp;</span><span class="nx">global</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">define</span><span class="o">===</span><span class="s2">&quot;function&quot;</span><span class="o">&amp;&amp;</span><span class="nx">define</span><span class="p">.</span><span class="nx">amd</span><span class="p">){</span><span class="nx">define</span><span class="p">([</span><span class="s2">&quot;underscore&quot;</span><span class="p">,</span><span class="s2">&quot;jquery&quot;</span><span class="p">,</span><span class="s2">&quot;exports&quot;</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">n</span><span class="p">){</span><span class="nx">e</span><span class="p">.</span><span class="nx">Backbone</span><span class="o">=</span><span class="nx">t</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">r</span><span class="p">)})}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span><span class="o">!==</span><span class="s2">&quot;undefined&quot;</span><span class="p">){</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;underscore&quot;</span><span class="p">),</span><span class="nx">r</span><span class="p">;</span><span class="k">try</span><span class="p">{</span><span class="nx">r</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;jquery&quot;</span><span class="p">)}</span><span class="k">catch</span><span class="p">(</span><span class="nx">n</span><span class="p">){}</span><span class="nx">t</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">exports</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">r</span><span class="p">)}</span><span class="k">else</span><span class="p">{</span><span class="nx">e</span><span class="p">.</span><span class="nx">Backbone</span><span class="o">=</span><span class="nx">t</span><span class="p">(</span><span class="nx">e</span><span class="p">,{},</span><span class="nx">e</span><span class="p">.</span><span class="nx">_</span><span class="p">,</span><span class="nx">e</span><span class="p">.</span><span class="nx">jQuery</span><span class="o">||</span><span class="nx">e</span><span class="p">.</span><span class="nx">Zepto</span><span class="o">||</span><span class="nx">e</span><span class="p">.</span><span class="nx">ender</span><span class="o">||</span><span class="nx">e</span><span class="p">.</span><span class="nx">$</span><span class="p">)}})(</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">;</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">;</span><span class="nx">e</span><span class="p">.</span><span class="nx">VERSION</span><span class="o">=</span><span class="s2">&quot;1.2.2&quot;</span><span class="p">;</span><span class="nx">e</span><span class="p">.</span><span class="nx">$</span><span class="o">=</span><span class="nx">r</span><span class="p">;</span><span class="nx">e</span><span class="p">.</span><span class="nx">noConflict</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="nx">t</span><span class="p">.</span><span class="nx">Backbone</span><span class="o">=</span><span class="nx">n</span><span class="p">;</span><span class="k">return</span> <span class="k">this</span><span class="p">};</span><span class="nx">e</span><span class="p">.</span><span class="nx">emulateHTTP</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">e</span><span class="p">.</span><span class="nx">emulateJSON</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="k">switch</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">case</span> <span class="mi">1</span><span class="o">:</span><span class="k">return</span> <span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="nx">i</span><span class="p">[</span><span class="nx">e</span><span class="p">](</span><span class="k">this</span><span class="p">[</span><span class="nx">r</span><span class="p">])};</span><span class="k">case</span> <span class="mi">2</span><span class="o">:</span><span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="nx">i</span><span class="p">[</span><span class="nx">e</span><span class="p">](</span><span class="k">this</span><span class="p">[</span><span class="nx">r</span><span class="p">],</span><span class="nx">t</span><span class="p">)};</span><span class="k">case</span> <span class="mi">3</span><span class="o">:</span><span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">n</span><span class="p">){</span><span class="k">return</span> <span class="nx">i</span><span class="p">[</span><span class="nx">e</span><span class="p">](</span><span class="k">this</span><span class="p">[</span><span class="nx">r</span><span class="p">],</span><span class="nx">h</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="k">this</span><span class="p">),</span><span class="nx">n</span><span class="p">)};</span><span class="k">case</span> <span class="mi">4</span><span class="o">:</span><span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">s</span><span class="p">){</span><span class="k">return</span> <span class="nx">i</span><span class="p">[</span><span class="nx">e</span><span class="p">](</span><span class="k">this</span><span class="p">[</span><span class="nx">r</span><span class="p">],</span><span class="nx">h</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="k">this</span><span class="p">),</span><span class="nx">n</span><span class="p">,</span><span class="nx">s</span><span class="p">)};</span><span class="k">default</span><span class="o">:</span><span class="k">return</span> <span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="nx">s</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span><span class="nx">t</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">r</span><span class="p">]);</span><span class="k">return</span> <span class="nx">i</span><span class="p">[</span><span class="nx">e</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">t</span><span class="p">)}}};</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="nx">i</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">n</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">[</span><span class="nx">n</span><span class="p">])</span><span class="nx">t</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span><span class="o">=</span><span class="nx">a</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">r</span><span class="p">)})};</span><span class="kd">var</span> <span class="nx">h</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">t</span><span class="p">))</span><span class="k">return</span> <span class="nx">t</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="nx">e</span><span class="p">.</span><span class="nx">_isModel</span><span class="p">(</span><span class="nx">t</span><span class="p">))</span><span class="k">return</span> <span class="nx">u</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">t</span><span class="p">))</span><span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">t</span><span class="p">)};</span><span class="k">return</span> <span class="nx">t</span><span class="p">};</span><span class="kd">var</span> <span class="nx">u</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span><span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="nx">e</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)}};</span><span class="kd">var</span> <span class="nx">l</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">Events</span><span class="o">=</span><span class="p">{};</span><span class="kd">var</span> <span class="nx">c</span><span class="o">=</span><span class="sr">/\s+/</span><span class="p">;</span><span class="kd">var</span> <span class="nx">f</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">s</span><span class="p">){</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">o</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">r</span><span class="o">&amp;&amp;</span><span class="k">typeof</span> <span class="nx">r</span><span class="o">===</span><span class="s2">&quot;object&quot;</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="o">!==</span><span class="k">void</span> <span class="mi">0</span><span class="o">&amp;&amp;</span><span class="s2">&quot;context&quot;</span><span class="k">in</span> <span class="nx">s</span><span class="o">&amp;&amp;</span><span class="nx">s</span><span class="p">.</span><span class="nx">context</span><span class="o">===</span><span class="k">void</span> <span class="mi">0</span><span class="p">)</span><span class="nx">s</span><span class="p">.</span><span class="nx">context</span><span class="o">=</span><span class="nx">n</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="nx">o</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">){</span><span class="nx">e</span><span class="o">=</span><span class="nx">f</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">o</span><span class="p">[</span><span class="nx">a</span><span class="p">],</span><span class="nx">r</span><span class="p">[</span><span class="nx">o</span><span class="p">[</span><span class="nx">a</span><span class="p">]],</span><span class="nx">s</span><span class="p">)}}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">r</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">r</span><span class="p">)){</span><span class="k">for</span><span class="p">(</span><span class="nx">o</span><span class="o">=</span><span class="nx">r</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">){</span><span class="nx">e</span><span class="o">=</span><span class="nx">t</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">o</span><span class="p">[</span><span class="nx">a</span><span class="p">],</span><span class="nx">n</span><span class="p">,</span><span class="nx">s</span><span class="p">)}}</span><span class="k">else</span><span class="p">{</span><span class="nx">e</span><span class="o">=</span><span class="nx">t</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">s</span><span class="p">)}</span><span class="k">return</span> <span class="nx">e</span><span class="p">};</span><span class="nx">l</span><span class="p">.</span><span class="nx">on</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="k">return</span> <span class="nx">d</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">)};</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">n</span><span class="p">){</span><span class="nx">t</span><span class="p">.</span><span class="nx">_events</span><span class="o">=</span><span class="nx">f</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span><span class="nx">t</span><span class="p">.</span><span class="nx">_events</span><span class="o">||</span><span class="p">{},</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">,{</span><span class="nx">context</span><span class="o">:</span><span class="nx">r</span><span class="p">,</span><span class="nx">ctx</span><span class="o">:</span><span class="nx">t</span><span class="p">,</span><span class="nx">listening</span><span class="o">:</span><span class="nx">n</span><span class="p">});</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="p">){</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">_listeners</span><span class="o">||</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">_listeners</span><span class="o">=</span><span class="p">{});</span><span class="nx">s</span><span class="p">[</span><span class="nx">n</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span><span class="o">=</span><span class="nx">n</span><span class="p">}</span><span class="k">return</span> <span class="nx">t</span><span class="p">};</span><span class="nx">l</span><span class="p">.</span><span class="nx">listenTo</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">;</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">_listenId</span><span class="o">||</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">_listenId</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">));</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_listeningTo</span><span class="o">||</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_listeningTo</span><span class="o">=</span><span class="p">{});</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="nx">s</span><span class="p">[</span><span class="nx">n</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="p">){</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_listenId</span><span class="o">||</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_listenId</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">));</span><span class="nx">a</span><span class="o">=</span><span class="nx">s</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="nx">obj</span><span class="o">:</span><span class="nx">t</span><span class="p">,</span><span class="nx">objId</span><span class="o">:</span><span class="nx">n</span><span class="p">,</span><span class="nx">id</span><span class="o">:</span><span class="nx">o</span><span class="p">,</span><span class="nx">listeningTo</span><span class="o">:</span><span class="nx">s</span><span class="p">,</span><span class="nx">count</span><span class="o">:</span><span class="mi">0</span><span class="p">}}</span><span class="nx">d</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">a</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">};</span><span class="kd">var</span> <span class="nx">v</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span><span class="o">||</span><span class="p">(</span><span class="nx">t</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span><span class="o">=</span><span class="p">[]);</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="nx">r</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span><span class="nx">a</span><span class="o">=</span><span class="nx">r</span><span class="p">.</span><span class="nx">ctx</span><span class="p">,</span><span class="nx">o</span><span class="o">=</span><span class="nx">r</span><span class="p">.</span><span class="nx">listening</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span><span class="nx">o</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">;</span><span class="nx">n</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">callback</span><span class="o">:</span><span class="nx">i</span><span class="p">,</span><span class="nx">context</span><span class="o">:</span><span class="nx">s</span><span class="p">,</span><span class="nx">ctx</span><span class="o">:</span><span class="nx">s</span><span class="o">||</span><span class="nx">a</span><span class="p">,</span><span class="nx">listening</span><span class="o">:</span><span class="nx">o</span><span class="p">})}</span><span class="k">return</span> <span class="nx">t</span><span class="p">};</span><span class="nx">l</span><span class="p">.</span><span class="nx">off</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="o">=</span><span class="nx">f</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,{</span><span class="nx">context</span><span class="o">:</span><span class="nx">i</span><span class="p">,</span><span class="nx">listeners</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">});</span><span class="k">return</span> <span class="k">this</span><span class="p">};</span><span class="nx">l</span><span class="p">.</span><span class="nx">stopListening</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_listeningTo</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">n</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">;</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="nx">t</span><span class="o">?</span><span class="p">[</span><span class="nx">t</span><span class="p">.</span><span class="nx">_listenId</span><span class="p">]</span><span class="o">:</span><span class="nx">i</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">){</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="nx">n</span><span class="p">[</span><span class="nx">s</span><span class="p">[</span><span class="nx">a</span><span class="p">]];</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">o</span><span class="p">)</span><span class="k">break</span><span class="p">;</span><span class="nx">o</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="k">this</span><span class="p">)}</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">n</span><span class="p">))</span><span class="k">this</span><span class="p">.</span><span class="nx">_listeningTo</span><span class="o">=</span><span class="k">void</span> <span class="mi">0</span><span class="p">;</span><span class="k">return</span> <span class="k">this</span><span class="p">};</span><span class="kd">var</span> <span class="nx">g</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">n</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">)</span><span class="k">return</span><span class="p">;</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">a</span><span class="p">;</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="nx">n</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span><span class="nx">h</span><span class="o">=</span><span class="nx">n</span><span class="p">.</span><span class="nx">listeners</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="o">&amp;&amp;!</span><span class="nx">r</span><span class="o">&amp;&amp;!</span><span class="nx">o</span><span class="p">){</span><span class="kd">var</span> <span class="nx">u</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">h</span><span class="p">);</span><span class="k">for</span><span class="p">(;</span><span class="nx">s</span><span class="o">&lt;</span><span class="nx">u</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">s</span><span class="o">++</span><span class="p">){</span><span class="nx">a</span><span class="o">=</span><span class="nx">h</span><span class="p">[</span><span class="nx">u</span><span class="p">[</span><span class="nx">s</span><span class="p">]];</span><span class="k">delete</span> <span class="nx">h</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span><span class="k">delete</span> <span class="nx">a</span><span class="p">.</span><span class="nx">listeningTo</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">objId</span><span class="p">]}</span><span class="k">return</span><span class="p">}</span><span class="kd">var</span> <span class="nx">l</span><span class="o">=</span><span class="nx">e</span><span class="o">?</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span><span class="o">:</span><span class="nx">i</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span><span class="k">for</span><span class="p">(;</span><span class="nx">s</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">s</span><span class="o">++</span><span class="p">){</span><span class="nx">e</span><span class="o">=</span><span class="nx">l</span><span class="p">[</span><span class="nx">s</span><span class="p">];</span><span class="kd">var</span> <span class="nx">c</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">e</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">c</span><span class="p">)</span><span class="k">break</span><span class="p">;</span><span class="kd">var</span> <span class="nx">f</span><span class="o">=</span><span class="p">[];</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">d</span><span class="o">&lt;</span><span class="nx">c</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">d</span><span class="o">++</span><span class="p">){</span><span class="kd">var</span> <span class="nx">v</span><span class="o">=</span><span class="nx">c</span><span class="p">[</span><span class="nx">d</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="nx">r</span><span class="o">&amp;&amp;</span><span class="nx">r</span><span class="o">!==</span><span class="nx">v</span><span class="p">.</span><span class="nx">callback</span><span class="o">&amp;&amp;</span><span class="nx">r</span><span class="o">!==</span><span class="nx">v</span><span class="p">.</span><span class="nx">callback</span><span class="p">.</span><span class="nx">_callback</span><span class="o">||</span><span class="nx">o</span><span class="o">&amp;&amp;</span><span class="nx">o</span><span class="o">!==</span><span class="nx">v</span><span class="p">.</span><span class="nx">context</span><span class="p">){</span><span class="nx">f</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">v</span><span class="p">)}</span><span class="k">else</span><span class="p">{</span><span class="nx">a</span><span class="o">=</span><span class="nx">v</span><span class="p">.</span><span class="nx">listening</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">&amp;&amp;--</span><span class="nx">a</span><span class="p">.</span><span class="nx">count</span><span class="o">===</span><span class="mi">0</span><span class="p">){</span><span class="k">delete</span> <span class="nx">h</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span><span class="k">delete</span> <span class="nx">a</span><span class="p">.</span><span class="nx">listeningTo</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">objId</span><span class="p">]}}}</span><span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span><span class="nx">t</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span><span class="o">=</span><span class="nx">f</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="k">delete</span> <span class="nx">t</span><span class="p">[</span><span class="nx">e</span><span class="p">]}}</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">t</span><span class="p">))</span><span class="k">return</span> <span class="nx">t</span><span class="p">};</span><span class="nx">l</span><span class="p">.</span><span class="nx">once</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">f</span><span class="p">(</span><span class="nx">p</span><span class="p">,{},</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">off</span><span class="p">,</span><span class="k">this</span><span class="p">));</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span><span class="k">void</span> <span class="mi">0</span><span class="p">,</span><span class="nx">r</span><span class="p">)};</span><span class="nx">l</span><span class="p">.</span><span class="nx">listenToOnce</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">f</span><span class="p">(</span><span class="nx">p</span><span class="p">,{},</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">stopListening</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">t</span><span class="p">));</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">n</span><span class="p">)};</span><span class="kd">var</span> <span class="nx">p</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">n</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">r</span><span class="p">){</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">n</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">s</span><span class="p">);</span><span class="nx">r</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)});</span><span class="nx">s</span><span class="p">.</span><span class="nx">_callback</span><span class="o">=</span><span class="nx">r</span><span class="p">}</span><span class="k">return</span> <span class="nx">t</span><span class="p">};</span><span class="nx">l</span><span class="p">.</span><span class="nx">trigger</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">;</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="nb">Array</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">r</span><span class="o">&lt;</span><span class="nx">e</span><span class="p">;</span><span class="nx">r</span><span class="o">++</span><span class="p">)</span><span class="nx">i</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">=</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">r</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span><span class="nx">f</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="k">void</span> <span class="mi">0</span><span class="p">,</span><span class="nx">i</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">};</span><span class="kd">var</span> <span class="nx">m</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">e</span><span class="p">];</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">all</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="o">&amp;&amp;</span><span class="nx">s</span><span class="p">)</span><span class="nx">s</span><span class="o">=</span><span class="nx">s</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="nx">_</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span><span class="nx">r</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="nx">_</span><span class="p">(</span><span class="nx">s</span><span class="p">,[</span><span class="nx">e</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">r</span><span class="p">))}</span><span class="k">return</span> <span class="nx">t</span><span class="p">};</span><span class="kd">var</span> <span class="nx">_</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">i</span><span class="p">,</span><span class="nx">r</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="nx">n</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span><span class="nx">s</span><span class="o">=</span><span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nx">a</span><span class="o">=</span><span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nx">o</span><span class="o">=</span><span class="nx">e</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="k">switch</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span><span class="k">case</span> <span class="mi">0</span><span class="o">:</span><span class="k">while</span><span class="p">(</span><span class="o">++</span><span class="nx">r</span><span class="o">&lt;</span><span class="nx">n</span><span class="p">)(</span><span class="nx">i</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">r</span><span class="p">]).</span><span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">ctx</span><span class="p">);</span><span class="k">return</span><span class="p">;</span><span class="k">case</span> <span class="mi">1</span><span class="o">:</span><span class="k">while</span><span class="p">(</span><span class="o">++</span><span class="nx">r</span><span class="o">&lt;</span><span class="nx">n</span><span class="p">)(</span><span class="nx">i</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">r</span><span class="p">]).</span><span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">ctx</span><span class="p">,</span><span class="nx">s</span><span class="p">);</span><span class="k">return</span><span class="p">;</span><span class="k">case</span> <span class="mi">2</span><span class="o">:</span><span class="k">while</span><span class="p">(</span><span class="o">++</span><span class="nx">r</span><span class="o">&lt;</span><span class="nx">n</span><span class="p">)(</span><span class="nx">i</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">r</span><span class="p">]).</span><span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">ctx</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">a</span><span class="p">);</span><span class="k">return</span><span class="p">;</span><span class="k">case</span> <span class="mi">3</span><span class="o">:</span><span class="k">while</span><span class="p">(</span><span class="o">++</span><span class="nx">r</span><span class="o">&lt;</span><span class="nx">n</span><span class="p">)(</span><span class="nx">i</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">r</span><span class="p">]).</span><span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">ctx</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">o</span><span class="p">);</span><span class="k">return</span><span class="p">;</span><span class="k">default</span><span class="o">:</span><span class="k">while</span><span class="p">(</span><span class="o">++</span><span class="nx">r</span><span class="o">&lt;</span><span class="nx">n</span><span class="p">)(</span><span class="nx">i</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">r</span><span class="p">]).</span><span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">ctx</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="k">return</span><span class="p">}};</span><span class="nx">l</span><span class="p">.</span><span class="nx">bind</span><span class="o">=</span><span class="nx">l</span><span class="p">.</span><span class="nx">on</span><span class="p">;</span><span class="nx">l</span><span class="p">.</span><span class="nx">unbind</span><span class="o">=</span><span class="nx">l</span><span class="p">.</span><span class="nx">off</span><span class="p">;</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">l</span><span class="p">);</span><span class="kd">var</span> <span class="nx">y</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">Model</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="nx">t</span><span class="o">||</span><span class="p">{};</span><span class="nx">e</span><span class="o">||</span><span class="p">(</span><span class="nx">e</span><span class="o">=</span><span class="p">{});</span><span class="k">this</span><span class="p">.</span><span class="nx">cid</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cidPrefix</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="o">=</span><span class="p">{};</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">collection</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">collection</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">parse</span><span class="p">)</span><span class="nx">r</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="nx">e</span><span class="p">)</span><span class="o">||</span><span class="p">{};</span><span class="nx">r</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({},</span><span class="nx">r</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;defaults&quot;</span><span class="p">));</span><span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">changed</span><span class="o">=</span><span class="p">{};</span><span class="k">this</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)};</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="nx">l</span><span class="p">,{</span><span class="nx">changed</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span><span class="nx">validationError</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span><span class="nx">idAttribute</span><span class="o">:</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="nx">cidPrefix</span><span class="o">:</span><span class="s2">&quot;c&quot;</span><span class="p">,</span><span class="nx">initialize</span><span class="o">:</span><span class="kd">function</span><span class="p">(){},</span><span class="nx">toJSON</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="nx">i</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)},</span><span class="nx">sync</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)},</span><span class="nx">get</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">t</span><span class="p">]},</span><span class="nx">escape</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="nx">i</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">t</span><span class="p">))},</span><span class="nx">has</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="o">!=</span><span class="kc">null</span><span class="p">},</span><span class="nx">matches</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span><span class="o">!!</span><span class="nx">i</span><span class="p">.</span><span class="nx">iteratee</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="k">this</span><span class="p">)(</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)},</span><span class="nx">set</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">;</span><span class="kd">var</span> <span class="nx">n</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">t</span><span class="o">===</span><span class="s2">&quot;object&quot;</span><span class="p">){</span><span class="nx">n</span><span class="o">=</span><span class="nx">t</span><span class="p">;</span><span class="nx">r</span><span class="o">=</span><span class="nx">e</span><span class="p">}</span><span class="k">else</span><span class="p">{(</span><span class="nx">n</span><span class="o">=</span><span class="p">{})[</span><span class="nx">t</span><span class="p">]</span><span class="o">=</span><span class="nx">e</span><span class="p">}</span><span class="nx">r</span><span class="o">||</span><span class="p">(</span><span class="nx">r</span><span class="o">=</span><span class="p">{});</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_validate</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span><span class="nx">r</span><span class="p">))</span><span class="k">return</span> <span class="kc">false</span><span class="p">;</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="nx">r</span><span class="p">.</span><span class="nx">unset</span><span class="p">;</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="nx">r</span><span class="p">.</span><span class="nx">silent</span><span class="p">;</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="p">[];</span><span class="kd">var</span> <span class="nx">h</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_changing</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_changing</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">h</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">_previousAttributes</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">changed</span><span class="o">=</span><span class="p">{}}</span><span class="kd">var</span> <span class="nx">u</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">;</span><span class="kd">var</span> <span class="nx">l</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">changed</span><span class="p">;</span><span class="kd">var</span> <span class="nx">c</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_previousAttributes</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">f</span> <span class="k">in</span> <span class="nx">n</span><span class="p">){</span><span class="nx">e</span><span class="o">=</span><span class="nx">n</span><span class="p">[</span><span class="nx">f</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">i</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">u</span><span class="p">[</span><span class="nx">f</span><span class="p">],</span><span class="nx">e</span><span class="p">))</span><span class="nx">o</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">f</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">i</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">c</span><span class="p">[</span><span class="nx">f</span><span class="p">],</span><span class="nx">e</span><span class="p">)){</span><span class="nx">l</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span><span class="o">=</span><span class="nx">e</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="k">delete</span> <span class="nx">l</span><span class="p">[</span><span class="nx">f</span><span class="p">]}</span><span class="nx">s</span><span class="o">?</span><span class="k">delete</span> <span class="nx">u</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span><span class="o">:</span><span class="nx">u</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span><span class="o">=</span><span class="nx">e</span><span class="p">}</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">idAttribute</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">_pending</span><span class="o">=</span><span class="nx">r</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">d</span><span class="o">&lt;</span><span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">d</span><span class="o">++</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;change:&quot;</span><span class="o">+</span><span class="nx">o</span><span class="p">[</span><span class="nx">d</span><span class="p">],</span><span class="k">this</span><span class="p">,</span><span class="nx">u</span><span class="p">[</span><span class="nx">o</span><span class="p">[</span><span class="nx">d</span><span class="p">]],</span><span class="nx">r</span><span class="p">)}}</span><span class="k">if</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="p">){</span><span class="k">while</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_pending</span><span class="p">){</span><span class="nx">r</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_pending</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_pending</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">r</span><span class="p">)}}</span><span class="k">this</span><span class="p">.</span><span class="nx">_pending</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_changing</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="k">return</span> <span class="k">this</span><span class="p">},</span><span class="nx">unset</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="k">void</span> <span class="mi">0</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span><span class="nx">e</span><span class="p">,{</span><span class="nx">unset</span><span class="o">:</span><span class="kc">true</span><span class="p">}))},</span><span class="nx">clear</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="p">{};</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">r</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span><span class="nx">e</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">=</span><span class="k">void</span> <span class="mi">0</span><span class="p">;</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span><span class="nx">t</span><span class="p">,{</span><span class="nx">unset</span><span class="o">:</span><span class="kc">true</span><span class="p">}))},</span><span class="nx">hasChanged</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span><span class="k">return</span><span class="o">!</span><span class="nx">i</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">changed</span><span class="p">);</span><span class="k">return</span> <span class="nx">i</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">changed</span><span class="p">,</span><span class="nx">t</span><span class="p">)},</span><span class="nx">changedAttributes</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">hasChanged</span><span class="p">()</span><span class="o">?</span><span class="nx">i</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">changed</span><span class="p">)</span><span class="o">:</span><span class="kc">false</span><span class="p">;</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_changing</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">_previousAttributes</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">;</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="p">{};</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">n</span> <span class="k">in</span> <span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">n</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="nx">n</span><span class="p">],</span><span class="nx">s</span><span class="p">))</span><span class="k">continue</span><span class="p">;</span><span class="nx">r</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span><span class="o">=</span><span class="nx">s</span><span class="p">}</span><span class="k">return</span> <span class="nx">i</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="o">?</span><span class="nx">r</span><span class="o">:</span><span class="kc">false</span><span class="p">},</span><span class="nx">previous</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="o">==</span><span class="kc">null</span><span class="o">||!</span><span class="k">this</span><span class="p">.</span><span class="nx">_previousAttributes</span><span class="p">)</span><span class="k">return</span> <span class="kc">null</span><span class="p">;</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_previousAttributes</span><span class="p">[</span><span class="nx">t</span><span class="p">]},</span><span class="nx">previousAttributes</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="nx">i</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_previousAttributes</span><span class="p">)},</span><span class="nx">fetch</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">t</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">parse</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span><span class="nx">t</span><span class="p">);</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">success</span><span class="p">;</span><span class="nx">t</span><span class="p">.</span><span class="nx">success</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">parse</span><span class="o">?</span><span class="nx">e</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">t</span><span class="p">)</span><span class="o">:</span><span class="nx">i</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span><span class="nx">t</span><span class="p">))</span><span class="k">return</span> <span class="kc">false</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="nx">r</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">t</span><span class="p">);</span><span class="nx">e</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;sync&quot;</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">t</span><span class="p">)};</span><span class="nx">z</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">t</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">t</span><span class="p">)},</span><span class="nx">save</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="o">==</span><span class="kc">null</span><span class="o">||</span><span class="k">typeof</span> <span class="nx">t</span><span class="o">===</span><span class="s2">&quot;object&quot;</span><span class="p">){</span><span class="nx">n</span><span class="o">=</span><span class="nx">t</span><span class="p">;</span><span class="nx">r</span><span class="o">=</span><span class="nx">e</span><span class="p">}</span><span class="k">else</span><span class="p">{(</span><span class="nx">n</span><span class="o">=</span><span class="p">{})[</span><span class="nx">t</span><span class="p">]</span><span class="o">=</span><span class="nx">e</span><span class="p">}</span><span class="nx">r</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">validate</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span><span class="nx">parse</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span><span class="nx">r</span><span class="p">);</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="nx">r</span><span class="p">.</span><span class="nx">wait</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="o">&amp;&amp;!</span><span class="nx">s</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span><span class="nx">r</span><span class="p">))</span><span class="k">return</span> <span class="kc">false</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_validate</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span><span class="nx">r</span><span class="p">))</span><span class="k">return</span> <span class="kc">false</span><span class="p">}</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="nx">r</span><span class="p">.</span><span class="nx">success</span><span class="p">;</span><span class="kd">var</span> <span class="nx">h</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">;</span><span class="nx">r</span><span class="p">.</span><span class="nx">success</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">attributes</span><span class="o">=</span><span class="nx">h</span><span class="p">;</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">r</span><span class="p">.</span><span class="nx">parse</span><span class="o">?</span><span class="nx">a</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">r</span><span class="p">)</span><span class="o">:</span><span class="nx">t</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="nx">e</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span><span class="nx">n</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="o">&amp;&amp;!</span><span class="nx">a</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">))</span><span class="k">return</span> <span class="kc">false</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span><span class="nx">o</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">r</span><span class="p">);</span><span class="nx">a</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;sync&quot;</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">r</span><span class="p">)};</span><span class="nx">z</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">r</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="o">&amp;&amp;</span><span class="nx">s</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span><span class="nx">h</span><span class="p">,</span><span class="nx">n</span><span class="p">);</span><span class="kd">var</span> <span class="nx">u</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">isNew</span><span class="p">()</span><span class="o">?</span><span class="s2">&quot;create&quot;</span><span class="o">:</span><span class="nx">r</span><span class="p">.</span><span class="nx">patch</span><span class="o">?</span><span class="s2">&quot;patch&quot;</span><span class="o">:</span><span class="s2">&quot;update&quot;</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">u</span><span class="o">===</span><span class="s2">&quot;patch&quot;</span><span class="o">&amp;&amp;!</span><span class="nx">r</span><span class="p">.</span><span class="nx">attrs</span><span class="p">)</span><span class="nx">r</span><span class="p">.</span><span class="nx">attrs</span><span class="o">=</span><span class="nx">n</span><span class="p">;</span><span class="kd">var</span> <span class="nx">l</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">r</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="o">=</span><span class="nx">h</span><span class="p">;</span><span class="k">return</span> <span class="nx">l</span><span class="p">},</span><span class="nx">destroy</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">t</span><span class="o">=</span><span class="nx">t</span><span class="o">?</span><span class="nx">i</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="o">:</span><span class="p">{};</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">success</span><span class="p">;</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">wait</span><span class="p">;</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="nx">e</span><span class="p">.</span><span class="nx">stopListening</span><span class="p">();</span><span class="nx">e</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;destroy&quot;</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">e</span><span class="p">.</span><span class="nx">collection</span><span class="p">,</span><span class="nx">t</span><span class="p">)};</span><span class="nx">t</span><span class="p">.</span><span class="nx">success</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="nx">s</span><span class="p">();</span><span class="k">if</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="nx">r</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">t</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">isNew</span><span class="p">())</span><span class="nx">e</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;sync&quot;</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">t</span><span class="p">)};</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isNew</span><span class="p">()){</span><span class="nx">i</span><span class="p">.</span><span class="nx">defer</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">success</span><span class="p">)}</span><span class="k">else</span><span class="p">{</span><span class="nx">z</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">t</span><span class="p">);</span><span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">t</span><span class="p">)}</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">n</span><span class="p">)</span><span class="nx">s</span><span class="p">();</span><span class="k">return</span> <span class="nx">a</span><span class="p">},</span><span class="nx">url</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;urlRoot&quot;</span><span class="p">)</span><span class="o">||</span><span class="nx">i</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">,</span><span class="s2">&quot;url&quot;</span><span class="p">)</span><span class="o">||</span><span class="nx">F</span><span class="p">();</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isNew</span><span class="p">())</span><span class="k">return</span> <span class="nx">t</span><span class="p">;</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">idAttribute</span><span class="p">);</span><span class="k">return</span> <span class="nx">t</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[^\/]$/</span><span class="p">,</span><span class="s2">&quot;$&amp;/&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">e</span><span class="p">)},</span><span class="nx">parse</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">t</span><span class="p">},</span><span class="nx">clone</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)},</span><span class="nx">isNew</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">idAttribute</span><span class="p">)},</span><span class="nx">isValid</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_validate</span><span class="p">({},</span><span class="nx">i</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({</span><span class="nx">validate</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span><span class="nx">t</span><span class="p">))},</span><span class="nx">_validate</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">validate</span><span class="o">||!</span><span class="k">this</span><span class="p">.</span><span class="nx">validate</span><span class="p">)</span><span class="k">return</span> <span class="kc">true</span><span class="p">;</span><span class="nx">t</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">,</span><span class="nx">t</span><span class="p">);</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">validationError</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">)</span><span class="o">||</span><span class="kc">null</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">)</span><span class="k">return</span> <span class="kc">true</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">e</span><span class="p">,{</span><span class="nx">validationError</span><span class="o">:</span><span class="nx">r</span><span class="p">}));</span><span class="k">return</span> <span class="kc">false</span><span class="p">}});</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="p">{</span><span class="nx">keys</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">values</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">pairs</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">invert</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">pick</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">omit</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">chain</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">isEmpty</span><span class="o">:</span><span class="mi">1</span><span class="p">};</span><span class="nx">o</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="s2">&quot;attributes&quot;</span><span class="p">);</span><span class="kd">var</span> <span class="nx">x</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">Collection</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="nx">e</span><span class="o">||</span><span class="p">(</span><span class="nx">e</span><span class="o">=</span><span class="p">{});</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">model</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">model</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">comparator</span><span class="o">!==</span><span class="k">void</span> <span class="mi">0</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">comparator</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">comparator</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_reset</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">reset</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">silent</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span><span class="nx">e</span><span class="p">))};</span><span class="kd">var</span> <span class="nx">w</span><span class="o">=</span><span class="p">{</span><span class="nx">add</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span><span class="nx">remove</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span><span class="nx">merge</span><span class="o">:</span><span class="kc">true</span><span class="p">};</span><span class="kd">var</span> <span class="nx">E</span><span class="o">=</span><span class="p">{</span><span class="nx">add</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span><span class="nx">remove</span><span class="o">:</span><span class="kc">false</span><span class="p">};</span><span class="kd">var</span> <span class="nx">k</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="nb">Array</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="nx">i</span><span class="p">);</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">s</span><span class="o">&lt;</span><span class="nx">r</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">s</span><span class="o">++</span><span class="p">)</span><span class="nx">r</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">s</span><span class="o">+</span><span class="nx">i</span><span class="p">];</span><span class="k">for</span><span class="p">(</span><span class="nx">s</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">s</span><span class="o">&lt;</span><span class="nx">n</span><span class="p">;</span><span class="nx">s</span><span class="o">++</span><span class="p">)</span><span class="nx">t</span><span class="p">[</span><span class="nx">s</span><span class="o">+</span><span class="nx">i</span><span class="p">]</span><span class="o">=</span><span class="nx">e</span><span class="p">[</span><span class="nx">s</span><span class="p">];</span><span class="k">for</span><span class="p">(</span><span class="nx">s</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">s</span><span class="o">&lt;</span><span class="nx">r</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">s</span><span class="o">++</span><span class="p">)</span><span class="nx">t</span><span class="p">[</span><span class="nx">s</span><span class="o">+</span><span class="nx">n</span><span class="o">+</span><span class="nx">i</span><span class="p">]</span><span class="o">=</span><span class="nx">r</span><span class="p">[</span><span class="nx">s</span><span class="p">]};</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="nx">l</span><span class="p">,{</span><span class="nx">model</span><span class="o">:</span><span class="nx">y</span><span class="p">,</span><span class="nx">initialize</span><span class="o">:</span><span class="kd">function</span><span class="p">(){},</span><span class="nx">toJSON</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(</span><span class="nx">t</span><span class="p">)})},</span><span class="nx">sync</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)},</span><span class="nx">add</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">merge</span><span class="o">:</span><span class="kc">false</span><span class="p">},</span><span class="nx">e</span><span class="p">,</span><span class="nx">E</span><span class="p">))},</span><span class="nx">remove</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="nx">e</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span><span class="nx">e</span><span class="p">);</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=!</span><span class="nx">i</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span><span class="nx">t</span><span class="o">=</span><span class="nx">r</span><span class="o">?</span><span class="p">[</span><span class="nx">t</span><span class="p">]</span><span class="o">:</span><span class="nx">i</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_removeModels</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">silent</span><span class="o">&amp;&amp;</span><span class="nx">n</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="k">return</span> <span class="nx">r</span><span class="o">?</span><span class="nx">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">:</span><span class="nx">n</span><span class="p">},</span><span class="nx">set</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span><span class="k">return</span><span class="p">;</span><span class="nx">e</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({},</span><span class="nx">e</span><span class="p">,</span><span class="nx">w</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">parse</span><span class="o">&amp;&amp;!</span><span class="k">this</span><span class="p">.</span><span class="nx">_isModel</span><span class="p">(</span><span class="nx">t</span><span class="p">))</span><span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=!</span><span class="nx">i</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span><span class="nx">t</span><span class="o">=</span><span class="nx">r</span><span class="o">?</span><span class="p">[</span><span class="nx">t</span><span class="p">]</span><span class="o">:</span><span class="nx">t</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">at</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="o">!=</span><span class="kc">null</span><span class="p">)</span><span class="nx">n</span><span class="o">=+</span><span class="nx">n</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="nx">n</span><span class="o">+=</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="p">[];</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="p">[];</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="p">[];</span><span class="kd">var</span> <span class="nx">h</span><span class="o">=</span><span class="p">{};</span><span class="kd">var</span> <span class="nx">u</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">add</span><span class="p">;</span><span class="kd">var</span> <span class="nx">l</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">merge</span><span class="p">;</span><span class="kd">var</span> <span class="nx">c</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">remove</span><span class="p">;</span><span class="kd">var</span> <span class="nx">f</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">comparator</span><span class="o">&amp;&amp;</span><span class="nx">n</span><span class="o">==</span><span class="kc">null</span><span class="o">&amp;&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">sort</span><span class="o">!==</span><span class="kc">false</span><span class="p">;</span><span class="kd">var</span> <span class="nx">v</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">comparator</span><span class="p">)</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">comparator</span><span class="o">:</span><span class="kc">null</span><span class="p">;</span><span class="kd">var</span> <span class="nx">g</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">p</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">p</span><span class="o">&lt;</span><span class="nx">t</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">p</span><span class="o">++</span><span class="p">){</span><span class="nx">g</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span><span class="kd">var</span> <span class="nx">m</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">g</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">m</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">l</span><span class="o">&amp;&amp;</span><span class="nx">g</span><span class="o">!==</span><span class="nx">m</span><span class="p">){</span><span class="kd">var</span> <span class="nx">_</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_isModel</span><span class="p">(</span><span class="nx">g</span><span class="p">)</span><span class="o">?</span><span class="nx">g</span><span class="p">.</span><span class="nx">attributes</span><span class="o">:</span><span class="nx">g</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">parse</span><span class="p">)</span><span class="nx">_</span><span class="o">=</span><span class="nx">m</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="nx">m</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">d</span><span class="o">&amp;&amp;!</span><span class="nx">f</span><span class="p">)</span><span class="nx">f</span><span class="o">=</span><span class="nx">m</span><span class="p">.</span><span class="nx">hasChanged</span><span class="p">(</span><span class="nx">v</span><span class="p">)}</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">h</span><span class="p">[</span><span class="nx">m</span><span class="p">.</span><span class="nx">cid</span><span class="p">]){</span><span class="nx">h</span><span class="p">[</span><span class="nx">m</span><span class="p">.</span><span class="nx">cid</span><span class="p">]</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="nx">s</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">m</span><span class="p">)}</span><span class="nx">t</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span><span class="o">=</span><span class="nx">m</span><span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">u</span><span class="p">){</span><span class="nx">g</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_prepareModel</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">g</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">g</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">_addReference</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="nx">h</span><span class="p">[</span><span class="nx">g</span><span class="p">.</span><span class="nx">cid</span><span class="p">]</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="nx">s</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">g</span><span class="p">)}}}</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="nx">p</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">p</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">p</span><span class="o">++</span><span class="p">){</span><span class="nx">g</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">h</span><span class="p">[</span><span class="nx">g</span><span class="p">.</span><span class="nx">cid</span><span class="p">])</span><span class="nx">o</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">g</span><span class="p">)}</span><span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">_removeModels</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="nx">e</span><span class="p">)}</span><span class="kd">var</span> <span class="nx">y</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=!</span><span class="nx">d</span><span class="o">&amp;&amp;</span><span class="nx">u</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="o">&amp;&amp;</span><span class="nx">b</span><span class="p">){</span><span class="nx">y</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="o">!=</span><span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="o">||</span><span class="nx">i</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">t</span><span class="o">!==</span><span class="nx">s</span><span class="p">[</span><span class="nx">e</span><span class="p">]});</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">length</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">k</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="nx">f</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="nx">k</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">n</span><span class="o">==</span><span class="kc">null</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="o">:</span><span class="nx">n</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">sort</span><span class="p">({</span><span class="nx">silent</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">silent</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="nx">p</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">p</span><span class="o">&lt;</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">p</span><span class="o">++</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="o">!=</span><span class="kc">null</span><span class="p">)</span><span class="nx">e</span><span class="p">.</span><span class="nx">index</span><span class="o">=</span><span class="nx">n</span><span class="o">+</span><span class="nx">p</span><span class="p">;</span><span class="nx">g</span><span class="o">=</span><span class="nx">a</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span><span class="nx">g</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;add&quot;</span><span class="p">,</span><span class="nx">g</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">e</span><span class="p">)}</span><span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="o">||</span><span class="nx">y</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;sort&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="o">||</span><span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">e</span><span class="p">)}</span><span class="k">return</span> <span class="nx">r</span><span class="o">?</span><span class="nx">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">:</span><span class="nx">t</span><span class="p">},</span><span class="nx">reset</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="nx">e</span><span class="o">=</span><span class="nx">e</span><span class="o">?</span><span class="nx">i</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">:</span><span class="p">{};</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">r</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">r</span><span class="o">++</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">_removeReference</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">[</span><span class="nx">r</span><span class="p">],</span><span class="nx">e</span><span class="p">)}</span><span class="nx">e</span><span class="p">.</span><span class="nx">previousModels</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_reset</span><span class="p">();</span><span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">silent</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span><span class="nx">e</span><span class="p">));</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">silent</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;reset&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="k">return</span> <span class="nx">t</span><span class="p">},</span><span class="nx">push</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">at</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">},</span><span class="nx">e</span><span class="p">))},</span><span class="nx">pop</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">)},</span><span class="nx">unshift</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">at</span><span class="o">:</span><span class="mi">0</span><span class="p">},</span><span class="nx">e</span><span class="p">))},</span><span class="nx">shift</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">)},</span><span class="nx">slice</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)},</span><span class="nx">get</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span><span class="k">return</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">modelId</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_isModel</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="o">?</span><span class="nx">t</span><span class="p">.</span><span class="nx">attributes</span><span class="o">:</span><span class="nx">t</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_byId</span><span class="p">[</span><span class="nx">t</span><span class="p">]</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">_byId</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">_byId</span><span class="p">[</span><span class="nx">t</span><span class="p">.</span><span class="nx">cid</span><span class="p">]},</span><span class="nx">at</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="nx">t</span><span class="o">+=</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">[</span><span class="nx">t</span><span class="p">]},</span><span class="nx">where</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">e</span><span class="o">?</span><span class="s2">&quot;find&quot;</span><span class="o">:</span><span class="s2">&quot;filter&quot;</span><span class="p">](</span><span class="nx">t</span><span class="p">)},</span><span class="nx">findWhere</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="kc">true</span><span class="p">)},</span><span class="nx">sort</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">comparator</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="p">)</span><span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Cannot sort a set without a comparator&quot;</span><span class="p">);</span><span class="nx">t</span><span class="o">||</span><span class="p">(</span><span class="nx">t</span><span class="o">=</span><span class="p">{});</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span><span class="nx">e</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="k">this</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">r</span><span class="o">===</span><span class="mi">1</span><span class="o">||</span><span class="nx">i</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">e</span><span class="p">)){</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">sortBy</span><span class="p">(</span><span class="nx">e</span><span class="p">)}</span><span class="k">else</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">e</span><span class="p">)}</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">silent</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;sort&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">t</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">},</span><span class="nx">pluck</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="nx">i</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">,</span><span class="s2">&quot;get&quot;</span><span class="p">,</span><span class="nx">t</span><span class="p">)},</span><span class="nx">fetch</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">t</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">parse</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span><span class="nx">t</span><span class="p">);</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">success</span><span class="p">;</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="nx">t</span><span class="p">.</span><span class="nx">success</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">reset</span><span class="o">?</span><span class="s2">&quot;reset&quot;</span><span class="o">:</span><span class="s2">&quot;set&quot;</span><span class="p">;</span><span class="nx">r</span><span class="p">[</span><span class="nx">n</span><span class="p">](</span><span class="nx">i</span><span class="p">,</span><span class="nx">t</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="nx">e</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">t</span><span class="p">);</span><span class="nx">r</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;sync&quot;</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">t</span><span class="p">)};</span><span class="nx">z</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">t</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">t</span><span class="p">)},</span><span class="nx">create</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="nx">e</span><span class="o">=</span><span class="nx">e</span><span class="o">?</span><span class="nx">i</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">:</span><span class="p">{};</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">wait</span><span class="p">;</span><span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_prepareModel</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">)</span><span class="k">return</span> <span class="kc">false</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">success</span><span class="p">;</span><span class="nx">e</span><span class="p">.</span><span class="nx">success</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="nx">n</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">i</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="nx">s</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">)};</span><span class="nx">t</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="k">return</span> <span class="nx">t</span><span class="p">},</span><span class="nx">parse</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">t</span><span class="p">},</span><span class="nx">clone</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">,{</span><span class="nx">model</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span><span class="nx">comparator</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">comparator</span><span class="p">})},</span><span class="nx">modelId</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="nx">t</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">idAttribute</span><span class="o">||</span><span class="s2">&quot;id&quot;</span><span class="p">]},</span><span class="nx">_reset</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="o">=</span><span class="p">[];</span><span class="k">this</span><span class="p">.</span><span class="nx">_byId</span><span class="o">=</span><span class="p">{}},</span><span class="nx">_prepareModel</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_isModel</span><span class="p">(</span><span class="nx">t</span><span class="p">)){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">collection</span><span class="p">)</span><span class="nx">t</span><span class="p">.</span><span class="nx">collection</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="k">return</span> <span class="nx">t</span><span class="p">}</span><span class="nx">e</span><span class="o">=</span><span class="nx">e</span><span class="o">?</span><span class="nx">i</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">:</span><span class="p">{};</span><span class="nx">e</span><span class="p">.</span><span class="nx">collection</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">.</span><span class="nx">validationError</span><span class="p">)</span><span class="k">return</span> <span class="nx">r</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">r</span><span class="p">.</span><span class="nx">validationError</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="k">return</span> <span class="kc">false</span><span class="p">},</span><span class="nx">_removeModels</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="p">[];</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">r</span><span class="o">&lt;</span><span class="nx">t</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">r</span><span class="o">++</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">t</span><span class="p">[</span><span class="nx">r</span><span class="p">]);</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">n</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="o">--</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">silent</span><span class="p">){</span><span class="nx">e</span><span class="p">.</span><span class="nx">index</span><span class="o">=</span><span class="nx">s</span><span class="p">;</span><span class="nx">n</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;remove&quot;</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="k">this</span><span class="p">,</span><span class="nx">e</span><span class="p">)}</span><span class="nx">i</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">_removeReference</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span><span class="nx">e</span><span class="p">)}</span><span class="k">return</span> <span class="nx">i</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span><span class="nx">i</span><span class="o">:</span><span class="kc">false</span><span class="p">},</span><span class="nx">_isModel</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="nx">t</span> <span class="k">instanceof</span> <span class="nx">y</span><span class="p">},</span><span class="nx">_addReference</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">_byId</span><span class="p">[</span><span class="nx">t</span><span class="p">.</span><span class="nx">cid</span><span class="p">]</span><span class="o">=</span><span class="nx">t</span><span class="p">;</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">modelId</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">attributes</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">!=</span><span class="kc">null</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">_byId</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">=</span><span class="nx">t</span><span class="p">;</span><span class="nx">t</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_onModelEvent</span><span class="p">,</span><span class="k">this</span><span class="p">)},</span><span class="nx">_removeReference</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_byId</span><span class="p">[</span><span class="nx">t</span><span class="p">.</span><span class="nx">cid</span><span class="p">];</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">modelId</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">attributes</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">!=</span><span class="kc">null</span><span class="p">)</span><span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_byId</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="o">===</span><span class="nx">t</span><span class="p">.</span><span class="nx">collection</span><span class="p">)</span><span class="k">delete</span> <span class="nx">t</span><span class="p">.</span><span class="nx">collection</span><span class="p">;</span><span class="nx">t</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_onModelEvent</span><span class="p">,</span><span class="k">this</span><span class="p">)},</span><span class="nx">_onModelEvent</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="k">if</span><span class="p">((</span><span class="nx">t</span><span class="o">===</span><span class="s2">&quot;add&quot;</span><span class="o">||</span><span class="nx">t</span><span class="o">===</span><span class="s2">&quot;remove&quot;</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nx">i</span><span class="o">!==</span><span class="k">this</span><span class="p">)</span><span class="k">return</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="o">===</span><span class="s2">&quot;destroy&quot;</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="o">===</span><span class="s2">&quot;change&quot;</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">modelId</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">previousAttributes</span><span class="p">());</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">modelId</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">attributes</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="o">!==</span><span class="nx">s</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="o">!=</span><span class="kc">null</span><span class="p">)</span><span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_byId</span><span class="p">[</span><span class="nx">n</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="nx">s</span><span class="o">!=</span><span class="kc">null</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">_byId</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span><span class="o">=</span><span class="nx">e</span><span class="p">}}</span><span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)}});</span><span class="kd">var</span> <span class="nx">S</span><span class="o">=</span><span class="p">{</span><span class="nx">forEach</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">each</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">map</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">collect</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">reduce</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span><span class="nx">foldl</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span><span class="nx">inject</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span><span class="nx">reduceRight</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span><span class="nx">foldr</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span><span class="nx">find</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">detect</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">filter</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">select</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">reject</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">every</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">all</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">some</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">any</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">include</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">includes</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">contains</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">invoke</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">max</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">min</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">toArray</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">size</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">first</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">head</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">take</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">initial</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">rest</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">tail</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">drop</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">last</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">without</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">difference</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">indexOf</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">shuffle</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">lastIndexOf</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">isEmpty</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">chain</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">sample</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">partition</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">groupBy</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">countBy</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">sortBy</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span><span class="nx">indexBy</span><span class="o">:</span><span class="mi">3</span><span class="p">};</span><span class="nx">o</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">S</span><span class="p">,</span><span class="s2">&quot;models&quot;</span><span class="p">);</span><span class="kd">var</span> <span class="nx">I</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">View</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">cid</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="s2">&quot;view&quot;</span><span class="p">);</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">pick</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">P</span><span class="p">));</span><span class="k">this</span><span class="p">.</span><span class="nx">_ensureElement</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)};</span><span class="kd">var</span> <span class="nx">T</span><span class="o">=</span><span class="sr">/^(\S+)\s*(.*)$/</span><span class="p">;</span><span class="kd">var</span> <span class="nx">P</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">,</span><span class="s2">&quot;collection&quot;</span><span class="p">,</span><span class="s2">&quot;el&quot;</span><span class="p">,</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span><span class="s2">&quot;className&quot;</span><span class="p">,</span><span class="s2">&quot;tagName&quot;</span><span class="p">,</span><span class="s2">&quot;events&quot;</span><span class="p">];</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">I</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="nx">l</span><span class="p">,{</span><span class="nx">tagName</span><span class="o">:</span><span class="s2">&quot;div&quot;</span><span class="p">,</span><span class="nx">$</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">t</span><span class="p">)},</span><span class="nx">initialize</span><span class="o">:</span><span class="kd">function</span><span class="p">(){},</span><span class="nx">render</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">},</span><span class="nx">remove</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">this</span><span class="p">.</span><span class="nx">_removeElement</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">stopListening</span><span class="p">();</span><span class="k">return</span> <span class="k">this</span><span class="p">},</span><span class="nx">_removeElement</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">remove</span><span class="p">()},</span><span class="nx">setElement</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">undelegateEvents</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">_setElement</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">delegateEvents</span><span class="p">();</span><span class="k">return</span> <span class="k">this</span><span class="p">},</span><span class="nx">_setElement</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="o">=</span><span class="nx">t</span> <span class="k">instanceof</span> <span class="nx">e</span><span class="p">.</span><span class="nx">$</span><span class="o">?</span><span class="nx">t</span><span class="o">:</span><span class="nx">e</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">[</span><span class="mi">0</span><span class="p">]},</span><span class="nx">delegateEvents</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">t</span><span class="o">||</span><span class="p">(</span><span class="nx">t</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;events&quot;</span><span class="p">));</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">undelegateEvents</span><span class="p">();</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">e</span> <span class="k">in</span> <span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">e</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">i</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">r</span><span class="p">))</span><span class="nx">r</span><span class="o">=</span><span class="k">this</span><span class="p">[</span><span class="nx">r</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">r</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">T</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="nx">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nx">n</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="nx">i</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="k">this</span><span class="p">))}</span><span class="k">return</span> <span class="k">this</span><span class="p">},</span><span class="nx">delegate</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">t</span><span class="o">+</span><span class="s2">&quot;.delegateEvents&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">cid</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">},</span><span class="nx">undelegateEvents</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s2">&quot;.delegateEvents&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">cid</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">},</span><span class="nx">undelegate</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="nx">t</span><span class="o">+</span><span class="s2">&quot;.delegateEvents&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">cid</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">},</span><span class="nx">_createElement</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">t</span><span class="p">)},</span><span class="nx">_ensureElement</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">){</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span><span class="nx">i</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;attributes&quot;</span><span class="p">));</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="nx">t</span><span class="p">.</span><span class="nx">id</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;id&quot;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">className</span><span class="p">)</span><span class="nx">t</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;className&quot;</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">setElement</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_createElement</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;tagName&quot;</span><span class="p">)));</span><span class="k">this</span><span class="p">.</span><span class="nx">_setAttributes</span><span class="p">(</span><span class="nx">t</span><span class="p">)}</span><span class="k">else</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">setElement</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;el&quot;</span><span class="p">))}},</span><span class="nx">_setAttributes</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">t</span><span class="p">)}});</span><span class="nx">e</span><span class="p">.</span><span class="nx">sync</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">n</span><span class="p">){</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="nx">H</span><span class="p">[</span><span class="nx">t</span><span class="p">];</span><span class="nx">i</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="nx">n</span><span class="o">||</span><span class="p">(</span><span class="nx">n</span><span class="o">=</span><span class="p">{}),{</span><span class="nx">emulateHTTP</span><span class="o">:</span><span class="nx">e</span><span class="p">.</span><span class="nx">emulateHTTP</span><span class="p">,</span><span class="nx">emulateJSON</span><span class="o">:</span><span class="nx">e</span><span class="p">.</span><span class="nx">emulateJSON</span><span class="p">});</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="p">{</span><span class="nx">type</span><span class="o">:</span><span class="nx">s</span><span class="p">,</span><span class="nx">dataType</span><span class="o">:</span><span class="s2">&quot;json&quot;</span><span class="p">};</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">n</span><span class="p">.</span><span class="nx">url</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">url</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="s2">&quot;url&quot;</span><span class="p">)</span><span class="o">||</span><span class="nx">F</span><span class="p">()}</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">data</span><span class="o">==</span><span class="kc">null</span><span class="o">&amp;&amp;</span><span class="nx">r</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">t</span><span class="o">===</span><span class="s2">&quot;create&quot;</span><span class="o">||</span><span class="nx">t</span><span class="o">===</span><span class="s2">&quot;update&quot;</span><span class="o">||</span><span class="nx">t</span><span class="o">===</span><span class="s2">&quot;patch&quot;</span><span class="p">)){</span><span class="nx">a</span><span class="p">.</span><span class="nx">contentType</span><span class="o">=</span><span class="s2">&quot;application/json&quot;</span><span class="p">;</span><span class="nx">a</span><span class="p">.</span><span class="nx">data</span><span class="o">=</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">attrs</span><span class="o">||</span><span class="nx">r</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(</span><span class="nx">n</span><span class="p">))}</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">emulateJSON</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">contentType</span><span class="o">=</span><span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">;</span><span class="nx">a</span><span class="p">.</span><span class="nx">data</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">data</span><span class="o">?</span><span class="p">{</span><span class="nx">model</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">data</span><span class="p">}</span><span class="o">:</span><span class="p">{}}</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">emulateHTTP</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">s</span><span class="o">===</span><span class="s2">&quot;PUT&quot;</span><span class="o">||</span><span class="nx">s</span><span class="o">===</span><span class="s2">&quot;DELETE&quot;</span><span class="o">||</span><span class="nx">s</span><span class="o">===</span><span class="s2">&quot;PATCH&quot;</span><span class="p">)){</span><span class="nx">a</span><span class="p">.</span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">emulateJSON</span><span class="p">)</span><span class="nx">a</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">_method</span><span class="o">=</span><span class="nx">s</span><span class="p">;</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="nx">n</span><span class="p">.</span><span class="nx">beforeSend</span><span class="p">;</span><span class="nx">n</span><span class="p">.</span><span class="nx">beforeSend</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">t</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;X-HTTP-Method-Override&quot;</span><span class="p">,</span><span class="nx">s</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span><span class="k">return</span> <span class="nx">o</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)}}</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">type</span><span class="o">!==</span><span class="s2">&quot;GET&quot;</span><span class="o">&amp;&amp;!</span><span class="nx">n</span><span class="p">.</span><span class="nx">emulateJSON</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">processData</span><span class="o">=</span><span class="kc">false</span><span class="p">}</span><span class="kd">var</span> <span class="nx">h</span><span class="o">=</span><span class="nx">n</span><span class="p">.</span><span class="nx">error</span><span class="p">;</span><span class="nx">n</span><span class="p">.</span><span class="nx">error</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="nx">n</span><span class="p">.</span><span class="nx">textStatus</span><span class="o">=</span><span class="nx">e</span><span class="p">;</span><span class="nx">n</span><span class="p">.</span><span class="nx">errorThrown</span><span class="o">=</span><span class="nx">i</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span><span class="nx">h</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">)};</span><span class="kd">var</span> <span class="nx">u</span><span class="o">=</span><span class="nx">n</span><span class="p">.</span><span class="nx">xhr</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">n</span><span class="p">));</span><span class="nx">r</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;request&quot;</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">u</span><span class="p">,</span><span class="nx">n</span><span class="p">);</span><span class="k">return</span> <span class="nx">u</span><span class="p">};</span><span class="kd">var</span> <span class="nx">H</span><span class="o">=</span><span class="p">{</span><span class="nx">create</span><span class="o">:</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span><span class="nx">update</span><span class="o">:</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span><span class="nx">patch</span><span class="o">:</span><span class="s2">&quot;PATCH&quot;</span><span class="p">,</span><span class="s2">&quot;delete&quot;</span><span class="o">:</span><span class="s2">&quot;DELETE&quot;</span><span class="p">,</span><span class="nx">read</span><span class="o">:</span><span class="s2">&quot;GET&quot;</span><span class="p">};</span><span class="nx">e</span><span class="p">.</span><span class="nx">ajax</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">$</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)};</span><span class="kd">var</span> <span class="nx">$</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">Router</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">t</span><span class="o">||</span><span class="p">(</span><span class="nx">t</span><span class="o">=</span><span class="p">{});</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">routes</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">routes</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">routes</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_bindRoutes</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)};</span><span class="kd">var</span> <span class="nx">A</span><span class="o">=</span><span class="sr">/\((.*?)\)/g</span><span class="p">;</span><span class="kd">var</span> <span class="nx">C</span><span class="o">=</span><span class="sr">/(\(\?)?:\w+/g</span><span class="p">;</span><span class="kd">var</span> <span class="nx">R</span><span class="o">=</span><span class="sr">/\*\w+/g</span><span class="p">;</span><span class="kd">var</span> <span class="nx">j</span><span class="o">=</span><span class="sr">/[\-{}\[\]+?.,\\\^$|#\s]/g</span><span class="p">;</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="nx">l</span><span class="p">,{</span><span class="nx">initialize</span><span class="o">:</span><span class="kd">function</span><span class="p">(){},</span><span class="nx">route</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">n</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">i</span><span class="p">.</span><span class="nx">isRegExp</span><span class="p">(</span><span class="nx">t</span><span class="p">))</span><span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_routeToRegExp</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">r</span><span class="p">)){</span><span class="nx">n</span><span class="o">=</span><span class="nx">r</span><span class="p">;</span><span class="nx">r</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">n</span><span class="p">)</span><span class="nx">n</span><span class="o">=</span><span class="k">this</span><span class="p">[</span><span class="nx">r</span><span class="p">];</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="nx">e</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="nx">s</span><span class="p">.</span><span class="nx">_extractParameters</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">i</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">r</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">){</span><span class="nx">s</span><span class="p">.</span><span class="nx">trigger</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">s</span><span class="p">,[</span><span class="s2">&quot;route:&quot;</span><span class="o">+</span><span class="nx">r</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">a</span><span class="p">));</span><span class="nx">s</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;route&quot;</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">a</span><span class="p">);</span><span class="nx">e</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;route&quot;</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">a</span><span class="p">)}});</span><span class="k">return</span> <span class="k">this</span><span class="p">},</span><span class="nx">execute</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="nx">t</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">e</span><span class="p">)},</span><span class="nx">navigate</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="nx">e</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">navigate</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">i</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">},</span><span class="nx">_bindRoutes</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">routes</span><span class="p">)</span><span class="k">return</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">routes</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;routes&quot;</span><span class="p">);</span><span class="kd">var</span> <span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">routes</span><span class="p">);</span><span class="k">while</span><span class="p">((</span><span class="nx">t</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">pop</span><span class="p">())</span><span class="o">!=</span><span class="kc">null</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="nx">t</span><span class="p">])}},</span><span class="nx">_routeToRegExp</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">t</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">j</span><span class="p">,</span><span class="s2">&quot;\\$&amp;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span><span class="s2">&quot;(?:$1)?&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">C</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">e</span><span class="o">?</span><span class="nx">t</span><span class="o">:</span><span class="s2">&quot;([^/?]+)&quot;</span><span class="p">}).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">R</span><span class="p">,</span><span class="s2">&quot;([^?]*?)&quot;</span><span class="p">);</span><span class="k">return</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="o">+</span><span class="nx">t</span><span class="o">+</span><span class="s2">&quot;(?:\\?([\\s\\S]*))?$&quot;</span><span class="p">)},</span><span class="nx">_extractParameters</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">e</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="k">return</span> <span class="nx">i</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="o">===</span><span class="nx">r</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span> <span class="nx">t</span><span class="o">||</span><span class="kc">null</span><span class="p">;</span><span class="k">return</span> <span class="nx">t</span><span class="o">?</span><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="o">:</span><span class="kc">null</span><span class="p">})}});</span><span class="kd">var</span> <span class="nx">N</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">History</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="o">=</span><span class="p">[];</span><span class="k">this</span><span class="p">.</span><span class="nx">checkUrl</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">checkUrl</span><span class="p">,</span><span class="k">this</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span><span class="o">!==</span><span class="s2">&quot;undefined&quot;</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">location</span><span class="o">=</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">history</span><span class="o">=</span><span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">}};</span><span class="kd">var</span> <span class="nx">M</span><span class="o">=</span><span class="sr">/^[#\/]|\s+$/g</span><span class="p">;</span><span class="kd">var</span> <span class="nx">O</span><span class="o">=</span><span class="sr">/^\/+|\/+$/g</span><span class="p">;</span><span class="kd">var</span> <span class="nx">U</span><span class="o">=</span><span class="sr">/#.*$/</span><span class="p">;</span><span class="nx">N</span><span class="p">.</span><span class="nx">started</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">N</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="nx">l</span><span class="p">,{</span><span class="nx">interval</span><span class="o">:</span><span class="mi">50</span><span class="p">,</span><span class="nx">atRoot</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[^\/]$/</span><span class="p">,</span><span class="s2">&quot;$&amp;/&quot;</span><span class="p">);</span><span class="k">return</span> <span class="nx">t</span><span class="o">===</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="o">&amp;&amp;!</span><span class="k">this</span><span class="p">.</span><span class="nx">getSearch</span><span class="p">()},</span><span class="nx">matchRoot</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">decodeFragment</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">);</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="p">;</span><span class="k">return</span> <span class="nx">e</span><span class="o">===</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">},</span><span class="nx">decodeFragment</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span> <span class="nb">decodeURI</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/%25/g</span><span class="p">,</span><span class="s2">&quot;%2525&quot;</span><span class="p">))},</span><span class="nx">getSearch</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#.*/</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\?.+/</span><span class="p">);</span><span class="k">return</span> <span class="nx">t</span><span class="o">?</span><span class="nx">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">:</span><span class="s2">&quot;&quot;</span><span class="p">},</span><span class="nx">getHash</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="p">(</span><span class="nx">t</span><span class="o">||</span><span class="k">this</span><span class="p">).</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/#(.*)$/</span><span class="p">);</span><span class="k">return</span> <span class="nx">e</span><span class="o">?</span><span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span><span class="s2">&quot;&quot;</span><span class="p">},</span><span class="nx">getPath</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">decodeFragment</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">getSearch</span><span class="p">()).</span><span class="nx">slice</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="k">return</span> <span class="nx">t</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">===</span><span class="s2">&quot;/&quot;</span><span class="o">?</span><span class="nx">t</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">:</span><span class="nx">t</span><span class="p">},</span><span class="nx">getFragment</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="o">==</span><span class="kc">null</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_usePushState</span><span class="o">||!</span><span class="k">this</span><span class="p">.</span><span class="nx">_wantsHashChange</span><span class="p">){</span><span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">getPath</span><span class="p">()}</span><span class="k">else</span><span class="p">{</span><span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">getHash</span><span class="p">()}}</span><span class="k">return</span> <span class="nx">t</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">M</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)},</span><span class="nx">start</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">N</span><span class="p">.</span><span class="nx">started</span><span class="p">)</span><span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Backbone.history has already been started&quot;</span><span class="p">);</span><span class="nx">N</span><span class="p">.</span><span class="nx">started</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">root</span><span class="o">:</span><span class="s2">&quot;/&quot;</span><span class="p">},</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span><span class="nx">t</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">root</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_wantsHashChange</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">hashChange</span><span class="o">!==</span><span class="kc">false</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_hasHashChange</span><span class="o">=</span><span class="s2">&quot;onhashchange&quot;</span><span class="k">in</span> <span class="nb">window</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentMode</span><span class="o">===</span><span class="k">void</span> <span class="mi">0</span><span class="o">||</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentMode</span><span class="o">&gt;</span><span class="mi">7</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">_useHashChange</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_wantsHashChange</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">_hasHashChange</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_wantsPushState</span><span class="o">=!!</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pushState</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_hasPushState</span><span class="o">=!!</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">history</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">pushState</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">_usePushState</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_wantsPushState</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">_hasPushState</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">getFragment</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">O</span><span class="p">,</span><span class="s2">&quot;/&quot;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_wantsHashChange</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">_wantsPushState</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_hasPushState</span><span class="o">&amp;&amp;!</span><span class="k">this</span><span class="p">.</span><span class="nx">atRoot</span><span class="p">()){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">||</span><span class="s2">&quot;/&quot;</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">e</span><span class="o">+</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">getPath</span><span class="p">());</span><span class="k">return</span> <span class="kc">true</span><span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_hasPushState</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">atRoot</span><span class="p">()){</span><span class="k">this</span><span class="p">.</span><span class="nx">navigate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getHash</span><span class="p">(),{</span><span class="nx">replace</span><span class="o">:</span><span class="kc">true</span><span class="p">})}}</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_hasHashChange</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">_wantsHashChange</span><span class="o">&amp;&amp;!</span><span class="k">this</span><span class="p">.</span><span class="nx">_usePushState</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;iframe&quot;</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s2">&quot;javascript:0&quot;</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">.</span><span class="nx">tabIndex</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">r</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">,</span><span class="nx">r</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">).</span><span class="nx">contentWindow</span><span class="p">;</span><span class="nx">n</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span><span class="nx">n</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span><span class="nx">n</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="p">}</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="o">||</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">attachEvent</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="o">+</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">)};</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_usePushState</span><span class="p">){</span><span class="nx">s</span><span class="p">(</span><span class="s2">&quot;popstate&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">checkUrl</span><span class="p">,</span><span class="kc">false</span><span class="p">)}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_useHashChange</span><span class="o">&amp;&amp;!</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">){</span><span class="nx">s</span><span class="p">(</span><span class="s2">&quot;hashchange&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">checkUrl</span><span class="p">,</span><span class="kc">false</span><span class="p">)}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_wantsHashChange</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">_checkUrlInterval</span><span class="o">=</span><span class="nx">setInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">checkUrl</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">interval</span><span class="p">)}</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">silent</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadUrl</span><span class="p">()},</span><span class="nx">stop</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="o">||</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">detachEvent</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="o">+</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">)};</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_usePushState</span><span class="p">){</span><span class="nx">t</span><span class="p">(</span><span class="s2">&quot;popstate&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">checkUrl</span><span class="p">,</span><span class="kc">false</span><span class="p">)}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_useHashChange</span><span class="o">&amp;&amp;!</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">){</span><span class="nx">t</span><span class="p">(</span><span class="s2">&quot;hashchange&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">checkUrl</span><span class="p">,</span><span class="kc">false</span><span class="p">)}</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">){</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="o">=</span><span class="kc">null</span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_checkUrlInterval</span><span class="p">)</span><span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_checkUrlInterval</span><span class="p">);</span><span class="nx">N</span><span class="p">.</span><span class="nx">started</span><span class="o">=</span><span class="kc">false</span><span class="p">},</span><span class="nx">route</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">.</span><span class="nx">unshift</span><span class="p">({</span><span class="nx">route</span><span class="o">:</span><span class="nx">t</span><span class="p">,</span><span class="nx">callback</span><span class="o">:</span><span class="nx">e</span><span class="p">})},</span><span class="nx">checkUrl</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">getFragment</span><span class="p">();</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="o">===</span><span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">){</span><span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">getHash</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">)}</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="o">===</span><span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="p">)</span><span class="k">return</span> <span class="kc">false</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">navigate</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">loadUrl</span><span class="p">()},</span><span class="nx">loadUrl</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">matchRoot</span><span class="p">())</span><span class="k">return</span> <span class="kc">false</span><span class="p">;</span><span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">getFragment</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span><span class="k">return</span> <span class="nx">i</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">t</span><span class="p">)){</span><span class="nx">e</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span><span class="k">return</span> <span class="kc">true</span><span class="p">}})},</span><span class="nx">navigate</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">N</span><span class="p">.</span><span class="nx">started</span><span class="p">)</span><span class="k">return</span> <span class="kc">false</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="o">||</span><span class="nx">e</span><span class="o">===</span><span class="kc">true</span><span class="p">)</span><span class="nx">e</span><span class="o">=</span><span class="p">{</span><span class="nx">trigger</span><span class="o">:!!</span><span class="nx">e</span><span class="p">};</span><span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">getFragment</span><span class="p">(</span><span class="nx">t</span><span class="o">||</span><span class="s2">&quot;&quot;</span><span class="p">);</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="o">===</span><span class="s2">&quot;&quot;</span><span class="o">||</span><span class="nx">t</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">===</span><span class="s2">&quot;?&quot;</span><span class="p">){</span><span class="nx">i</span><span class="o">=</span><span class="nx">i</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">||</span><span class="s2">&quot;/&quot;</span><span class="p">}</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="nx">i</span><span class="o">+</span><span class="nx">t</span><span class="p">;</span><span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">decodeFragment</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">U</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">));</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="o">===</span><span class="nx">t</span><span class="p">)</span><span class="k">return</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="o">=</span><span class="nx">t</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_usePushState</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">history</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">replace</span><span class="o">?</span><span class="s2">&quot;replaceState&quot;</span><span class="o">:</span><span class="s2">&quot;pushState&quot;</span><span class="p">]({},</span><span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span><span class="nx">r</span><span class="p">)}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_wantsHashChange</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">_updateHash</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">.</span><span class="nx">replace</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="o">&amp;&amp;</span><span class="nx">t</span><span class="o">!==</span><span class="k">this</span><span class="p">.</span><span class="nx">getHash</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">)){</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">replace</span><span class="p">){</span><span class="nx">n</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span><span class="nx">n</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">close</span><span class="p">()}</span><span class="k">this</span><span class="p">.</span><span class="nx">_updateHash</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">.</span><span class="nx">replace</span><span class="p">)}}</span><span class="k">else</span><span class="p">{</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">r</span><span class="p">)}</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">trigger</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadUrl</span><span class="p">(</span><span class="nx">t</span><span class="p">)},</span><span class="nx">_updateHash</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(javascript:|#).*$/</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">);</span><span class="nx">t</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">r</span><span class="o">+</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="nx">e</span><span class="p">)}</span><span class="k">else</span><span class="p">{</span><span class="nx">t</span><span class="p">.</span><span class="nx">hash</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="nx">e</span><span class="p">}}});</span><span class="nx">e</span><span class="p">.</span><span class="nx">history</span><span class="o">=</span><span class="k">new</span> <span class="nx">N</span><span class="p">;</span><span class="kd">var</span> <span class="nx">q</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="kd">var</span> <span class="nx">n</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="o">&amp;&amp;</span><span class="nx">i</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="s2">&quot;constructor&quot;</span><span class="p">)){</span><span class="nx">n</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">constructor</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="nx">n</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="nx">r</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)}}</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="k">this</span><span class="p">.</span><span class="nx">constructor</span><span class="o">=</span><span class="nx">n</span><span class="p">};</span><span class="nx">s</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="nx">r</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span><span class="nx">n</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="k">new</span> <span class="nx">s</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="nx">i</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span><span class="nx">t</span><span class="p">);</span><span class="nx">n</span><span class="p">.</span><span class="nx">__super__</span><span class="o">=</span><span class="nx">r</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span><span class="k">return</span> <span class="nx">n</span><span class="p">};</span><span class="nx">y</span><span class="p">.</span><span class="nx">extend</span><span class="o">=</span><span class="nx">x</span><span class="p">.</span><span class="nx">extend</span><span class="o">=</span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="o">=</span><span class="nx">I</span><span class="p">.</span><span class="nx">extend</span><span class="o">=</span><span class="nx">N</span><span class="p">.</span><span class="nx">extend</span><span class="o">=</span><span class="nx">q</span><span class="p">;</span><span class="kd">var</span> <span class="nx">F</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;A &quot;url&quot; property or function must be specified&#39;</span><span class="p">)};</span><span class="kd">var</span> <span class="nx">z</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">error</span><span class="p">;</span><span class="nx">e</span><span class="p">.</span><span class="nx">error</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="nx">i</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="nx">t</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">e</span><span class="p">)}};</span><span class="k">return</span> <span class="nx">e</span><span class="p">});</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="sourcemappingurl%3Dbackbone-min.map">
  <h1>
    <a href="#sourcemappingurl%3Dbackbone-min.map" name="sourcemappingurl%3Dbackbone-min.map" class="pilcrow">&#182;</a>
    sourceMappingURL=backbone-min.map
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
